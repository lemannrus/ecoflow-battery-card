# Example Configuration for Eco Battery Card v0.3.0
# With Multi-Battery Support and Outage Integration

# ============================================
# Single Battery Configuration (Basic)
# ============================================
type: custom:smart-battery-card
batteries:
  - entity: sensor.ecoflow_battery
    name: Delta 2

---

# ============================================
# Single Battery with Full Features
# ============================================
type: custom:smart-battery-card
batteries:
  - entity: sensor.delta_2_main_battery_level
    name: Delta 2
    remaining_time_entity: sensor.delta_2_discharge_remaining_time
    charge_remaining_time_entity: sensor.delta_2_charge_remaining_time
    ac_out_power_entity: sensor.delta_2_ac_out_power

# Outage Integration (using Yasno Integration)
outage_status_entity: sensor.yasno_kiiv_dtek_2_2_electricity
outage_end_time_entity: sensor.yasno_kiiv_dtek_2_2_next_connectivity
next_outage_time_entity: sensor.yasno_kiiv_dtek_2_2_next_planned_outage

# Display Settings
green: 60
yellow: 25
precision: 0
segments: 5
gap: 2
palette: gradient

---

# ============================================
# Multi-Battery Configuration
# ============================================
type: custom:smart-battery-card
batteries:
  # Battery 1: EcoFlow Delta 2
  - entity: sensor.delta_2_main_battery_level
    name: Delta 2
    remaining_time_entity: sensor.delta_2_discharge_remaining_time
    charge_remaining_time_entity: sensor.delta_2_charge_remaining_time
    ac_out_power_entity: sensor.delta_2_ac_out_power
  
  # Battery 2: EcoFlow River 2
  - entity: sensor.river_2_battery_level
    name: River 2
    remaining_time_entity: sensor.river_2_discharge_remaining_time
    charge_remaining_time_entity: sensor.river_2_charge_remaining_time
    ac_out_power_entity: sensor.river_2_ac_out_power
  
  # Battery 3: EcoFlow Delta Pro (optional)
  - entity: sensor.delta_pro_battery_level
    name: Delta Pro
    remaining_time_entity: sensor.delta_pro_discharge_remaining_time
    charge_remaining_time_entity: sensor.delta_pro_charge_remaining_time
    ac_out_power_entity: sensor.delta_pro_ac_out_power

# Which battery to use for outage analysis (0 = first, 1 = second, etc.)
selected_battery: 0

# Outage Integration (shared for all batteries)
outage_status_entity: sensor.yasno_kiiv_dtek_2_2_electricity
outage_end_time_entity: sensor.yasno_kiiv_dtek_2_2_next_connectivity
next_outage_time_entity: sensor.yasno_kiiv_dtek_2_2_next_planned_outage

# Display Settings (applied to all batteries)
green: 60
yellow: 25
precision: 0
segments: 5
gap: 2
palette: threshold

---

# ============================================
# Configuration Option Explanations
# ============================================

# BATTERIES ARRAY (Required):
#   Each battery object can have:
#   - entity: (Required) Battery level sensor (0-100%)
#   - name: (Optional) Display name for the battery
#   - remaining_time_entity: (Optional) Discharge time in minutes
#   - charge_remaining_time_entity: (Optional) Charge time in minutes
#   - ac_out_power_entity: (Optional) AC output power in watts
#   - invert: (Optional) Invert battery reading if needed

# SELECTED_BATTERY (Optional, default: 0):
#   Index of which battery to use for outage analysis
#   0 = first battery, 1 = second battery, etc.

# OUTAGE ENTITIES (Optional):
#   outage_status_entity: Current outage status
#     Supported states: 'on'/'off', 'true'/'false', 'active'/'inactive', '1'/'0'
#   
#   outage_end_time_entity: When current outage ends
#     Format: ISO datetime (2025-11-13T14:30:00) or Unix timestamp
#   
#   next_outage_time_entity: When next outage starts
#     Format: ISO datetime (2025-11-13T14:30:00) or Unix timestamp

# DISPLAY SETTINGS (Optional):
#   green: Battery % threshold for green color (default: 60)
#   yellow: Battery % threshold for yellow color (default: 25)
#   precision: Decimal places for percentage (default: 0)
#   segments: Number of battery segments (default: 5)
#   gap: Gap between segments in pixels (default: 2)
#   palette: 'threshold' (red/yellow/green) or 'gradient' (default: threshold)
#   show_state: Show percentage text on battery (default: true)

---

# ============================================
# NEW in v0.3.0: Multi-Battery Features
# ============================================

# 1. Vertical Battery Layout
#    - Batteries now fill bottom-to-top (like real batteries)
#    - Energy flow moves downward to status circle
#    - Each battery shows its name at the top

# 2. Dynamic Layout
#    - 1 battery: Centered
#    - 2 batteries: Left and right
#    - 3+ batteries: Distributed grid

# 3. Individual Monitoring
#    - Each battery shows its own percentage, time, and power
#    - Independent status indicators (charging/discharging/idle)
#    - Separate energy flow animations

# 4. Selected Battery Analysis
#    - Choose which battery to use for outage calculations
#    - Outage warnings reference the selected battery by name
#    - Example: "âš ï¸ Delta 2 may run out before outage ends"

# 5. Compact Display
#    - Time and power info below each battery
#    - Unified outage section at the bottom
#    - Auto-adjusting card height

---

# ============================================
# Integration with HA Yasno Outages
# ============================================

# The HA Yasno Outages integration provides Ukrainian electricity 
# outage schedules from DTEK/Yasno. It's perfect for this card!

# Installation:
# 1. Open HACS â†’ Integrations
# 2. Search for "Yasno Outages"
# 3. Install and restart Home Assistant
# 4. Add integration and select your city and group

# Entity Mapping:
# - outage_status_entity: sensor.yasno_{city}_dtek_{group}_electricity
# - outage_end_time_entity: sensor.yasno_{city}_dtek_{group}_next_connectivity
# - next_outage_time_entity: sensor.yasno_{city}_dtek_{group}_next_planned_outage

# Example for Kyiv, Group 2.2:
#   outage_status_entity: sensor.yasno_kiiv_dtek_2_2_electricity
#   outage_end_time_entity: sensor.yasno_kiiv_dtek_2_2_next_connectivity
#   next_outage_time_entity: sensor.yasno_kiiv_dtek_2_2_next_planned_outage

# GitHub: https://github.com/denysdovhan/ha-yasno-outages

---

# ============================================
# Smart Outage Analysis Features
# ============================================

# 1. Battery Sufficiency Check (During Outage)
#    Compares battery discharge time vs remaining outage time
#    - âœ… "Battery sufficient for outage" (Green)
#    - âš ï¸ "Battery may run out before outage ends!" (Red, pulsing)

# 2. Charging Time Analysis (Before Outage)
#    Uses charge_remaining_time_entity to see if you can charge in time
#    - âœ… "Plenty of time to charge before outage" (Green)
#    - â° "Start charging soon - limited time margin" (Blue)
#    - âš ï¸ "Not enough time to fully charge!" (Yellow)

# 3. Visual Indicators
#    - Red pulsing border: Critical warning
#    - Yellow background: Warning
#    - Blue background: Informational
#    - Green background: All good

# 4. Compact Display
#    Active Outage:
#      ðŸ”Œ Outage Active
#      Ends: Today 14:30 â€¢ Remaining: 2h 15min
#    
#    Next Outage:
#      ðŸ“… Next Outage
#      Today 18:00 â€¢ In: 3h 45min

---

# ============================================
# Breaking Changes from v0.2.x
# ============================================

# âš ï¸ Configuration structure has changed!
# Old format (v0.2.x):
#   entity: sensor.battery
#   name: My Battery
#   remaining_time_entity: sensor.time
#
# New format (v0.3.0+):
#   batteries:
#     - entity: sensor.battery
#       name: My Battery
#       remaining_time_entity: sensor.time

# Migration is simple: wrap your battery config in a batteries array!

# Removed options:
#   - charge_rate_watts (no longer needed)
#   - battery_capacity_wh (no longer needed)
#   - outage_schedule_entity (removed in v0.2.1)

# The card now uses your charge_remaining_time_entity directly,
# making it more accurate and eliminating manual calculations!

---

# ============================================
# Tips for Best Results
# ============================================

# 1. Battery Names
#    Use short, descriptive names like "Delta 2" or "River"
#    They display at the top of each battery

# 2. Time Sensors
#    Make sure your time sensors report in MINUTES
#    The card will format them automatically (e.g., "2h 15min")

# 3. Power Sensors
#    AC output power should be in WATTS
#    The card auto-formats (e.g., "1.2kW" for 1200W)

# 4. Selected Battery
#    Choose the battery with the most critical role for outage analysis
#    Usually your largest or primary battery

# 5. Outage Entities
#    Test that your outage sensors update correctly
#    Check the Yasno integration if using DTEK schedules

# 6. Layout
#    The card height adjusts automatically
#    Works great on mobile, tablet, and desktop
#    Consider using 2 columns for 4+ batteries

---

# ============================================
# Troubleshooting
# ============================================

# Card shows "You must specify at least one battery"
#   â†’ Make sure you have a `batteries` array with at least one battery object

# Battery shows "unavailable"
#   â†’ Check that the entity exists and reports 0-100%

# No energy flow animation
#   â†’ Verify ac_out_power_entity exists and reports > 0 watts

# No time display
#   â†’ Check that remaining_time_entity or charge_remaining_time_entity
#     exists and reports a number (minutes)

# Outage analysis not working
#   â†’ Verify all three outage entities are configured and reporting data
#   â†’ Check that selected_battery index is valid (0 for first battery)

# Batteries not displaying correctly
#   â†’ Clear browser cache and hard reload (Ctrl+Shift+R or Cmd+Shift+R)
#   â†’ Check browser console for errors (F12)

# Multi-battery layout looks wrong
#   â†’ The layout auto-adjusts: 1 centered, 2 left/right, 3+ grid
#   â†’ Try refreshing the page or reloading the card

---

# For more information and updates:
# GitHub: https://github.com/lemannrus/ecoflow-battery-card
# Issues: https://github.com/lemannrus/ecoflow-battery-card/issues
